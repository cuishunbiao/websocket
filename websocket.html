<!DOCTYPE html>
<html>
<head>
    <title>WebSocket</title>
</head>
<body>
<script type="text/javascript">
    // 浏览器提供 WebSocket 对象
    var timer;
    var startFn = function() {
        var ws = new WebSocket('ws://localhost:3000');
        ws.onmessage = function(mes) {
            console.log(mes.data);
            clearTimeout(timer);//清除计时
            timerFn();//开始计时
        };
        //错误，需要重新发起请求
        ws.onerror = function(mes) {
            clearTimeout(timer);
            timerFn();//重新发起请求
        };
    };
    var timerFn = function() {
        timer = setTimeout(function() {
            startFn();//重新发起请求
        }, 45000);
    };
    startFn();
</script>
</body>
</html>